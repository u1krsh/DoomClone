#include <stdio.h>
#include <GL/glut.h>
#include <math.h>

#define res 1 //resolotion scale
#define SH 160*res //screen height
#define SW 120*res //screen width
#define HSH SH/2 //half screen height
#define HSW SW/2 //half screen width
#define pixelScale  4/res //open gl pixel size
#define GSLW SW*pixelScale //open gl window width
#define GSLH SH*pixelScale //open gl window height


typedef struct {
	int fr1, fr2; // these are frame 1 and 2 for a constant frame rate
}time; 
time T;

typedef struct {
	int w, a, s, d;
	int sl, sr;
}keys;
keys K;


void pixel(int x, int y, int c) { //draws pixel at x,y with color c
	int rgb[3] = {0,0,0}; // Initialize all elements to 0
	if (c == 0) { rgb[0] = 255; rgb[1] = 0; rgb[2] = 0; }// red
	if (c == 1) { rgb[0] = 160; rgb[1] = 0; rgb[2] = 0; }// darkred

	if (c == 2) { rgb[0] = 0; rgb[1] = 255; rgb[2] = 0; }// green
	if (c == 3) { rgb[0] = 0; rgb[1] = 160; rgb[2] = 0; }// darkgreen

	if (c == 4) { rgb[0] = 0; rgb[1] = 0; rgb[2] = 255; }// blue
	if (c == 5) { rgb[0] = 0; rgb[1] = 0; rgb[2] = 160; }// darkblue

	if (c == 6) { rgb[0] = 0; rgb[1] = 60; rgb[2] = 130; } //background 
	glColor3ub(rgb[0], rgb[1], rgb[2]);
	glBegin(GL_POINTS);
	glVertex2i(x*pixelScale+2, y*pixelScale+2);
	glEnd();	
}

void movePl() {
	if (K.w == 1) { printf("forward\n"); }
	if (K.a = 1) { printf("left\n"); }
	if (K.s = 1) { printf("backwards\n"); }
	if (K.d = 1) { printf("right\n"); }

	if (K.sr = 1) { printf("strafe right\n"); }
	if (K.sl = 1) { printf("strafe left\n"); }
}

void clearBackground() {
	int x, y;
	for (y = 0; y < SH; y++) {
		for (x = 0; x < SW; x++) {
			pixel(x, y, 6); //clear background 
		}
	}
}

int tick;

void draw3D() { // real sussy baka
	int x, y, c = 0;
	for (y = 0; y < HSH; y++) {
		for (x = 0; x < HSW; x++) {
			pixel(x, y, c);
			c = c + 1;
			if (c > 6) {
				c = 0;
			}
		}
	}

	tick = tick + 1;
	if (tick > 20) {
		tick = 0;
	}
	pixel(HSW, HSH + tick, 0);
}

void display() {
	int x, y;

	if (T.fr1 - T.fr2 >=50) { //20 fps
		clearBackground();
		movePl();
		draw3D();
		T.fr2 = T.fr1;
		glutSwapBuffers();
		glutReshapeWindow(GSLW, GSLH); // stops from resizeing window
	}
	T.fr1 = glutGet(GLUT_ELAPSED_TIME); 
	glutPostRedisplay();
}

// Add program entry point so the linker can find `main`.
int main(int argc, char** argv) {
	// Initialize GLUT and create window
	glutInit(&argc, argv);
	glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB);
	glutInitWindowSize(GSLW, GSLH);
	glutCreateWindow("Doom Test");

	// Set up2D orthographic projection matching window coordinates
	glViewport(0,0, GSLW, GSLH);
	glMatrixMode(GL_PROJECTION);
	glLoadIdentity();
	gluOrtho2D(0, GSLW,0, GSLH);
	glMatrixMode(GL_MODELVIEW);
	glLoadIdentity();

	// Set point size so logical pixels are visible (optional)
	glPointSize((GLfloat)pixelScale);

	// Register callbacks
	glutDisplayFunc(display);

	// Initialize frame timing
	T.fr1 = T.fr2 = glutGet(GLUT_ELAPSED_TIME);

	// Enter main loop
	glutMainLoop();

	return0;
}